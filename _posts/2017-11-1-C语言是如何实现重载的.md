---
title: C语言是如何实现重载的
date: 2017-11-1 11：16：50
tags: C 重载
description: C++和JAVA等主流面向对象的语言都有重载的概念，那么C有没有呢？实际上是有的，让我们一探究竟。
---

### C语言是如何实现重载的

```void print(const char *format , ...);```

上面一串函数声明就做到了函数的重载，不知道你有没有注意到第二个参数位置处的*占位符*呢，我们在输入形参的时候，```print```函数会根据不同的形参个数进行不同的操作。那么它究竟是如何实现的呢？

下面就是重载实现的奥秘...

```c
typedef __builtin_va_list va_list;
#define va_start(ap, last)
#define va_arg(ap, type)
#define va_end(ap)
```

>1. va_list
>2. va_start
>3. va_arg
>4. va_end

上面的代码实际上已经是真实C库代码了。上面的宏```__builtin_va_list```是被定义在gcc编译器中。

```va_list```是将参数打包存放的数据结构，```va_start```是告诉ap指针，第一个参数在```last```那，```last```就是第一个参数，```va_arg```得到类型，而且ap已经指向第二个参数了，这样就可以继续读下去了。```va_end```实现了当```ap```指针为```\0```,即到达了尾部就告诉函数可以不用再读取了。

> 注意：上面的函数的功能是建立在“函数调用的参数在内存里是连续的”这一假设之上的。

那么另外函数参数是如何存放的呢？我们都知道是用栈来实现。

c语言默认的调用约定是[```cdecl```](https://zh.wikipedia.org/wiki/X86%E8%B0%83%E7%94%A8%E7%BA%A6%E5%AE%9A)函数，实参在线程栈上按照从右至左的顺序依次压栈。