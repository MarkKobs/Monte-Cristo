---
title: 学生成绩管理系统的数据库设计MODEL部分
date: 2017-10-01 00:23:23
tags: database
category: database
---

# 学生成绩管理系统的数据库设计MODEL部分

## 功能分析：
1. 管理员功能
- 添加(create)、修改(update)、删除(delte)学生成绩信息
- 添加(create)、修改(update)、删除(delte)学生信息
2. 学生功能
- 查询成绩

```

graph TD
    A[管理员]-->B(发布成绩)
    A-->C(查询成绩)
    A-->D(修改成绩)
    B-->E[成绩单]
    C-->F[学生]
    E-->F
    D-->G[存储成绩]
```

### 创建数据库

```javascript
create database XXX
```
*相对应的配置需要在laravel中配置*
### 学生表

```javascript
create table stu(
sno varchar(10) primary key,
sname varchar(10) not null,
ssex varchar(2) not null,
sage varchar(2) not null,
major varchar(10) not null,
depart varchar(10) not null
);
```
### 课程表

```javascript
create table cla(
cno varchar(10) primary key,
cname varchar(10) not null,
teano varchar(10) not null,
credit varchar(4) not null
);
```
### 学生成绩表

```javascript
create table sco(
sno varchar(10) not null,
cno varchar(10) not null,
cdegree varchar(10) not null,
cname varchar(10) not null,
foreign key(sno) references stu(sno),
foreign key(cno) references cla(cno)，
)engine=InnoDB;
```

#### Model设计
##### 数据库连接
learnlaravel5 目录下已经有了一个 .env 文件，如果没有，可以复制一份 .env.example 文件重命名成 .env，修改下面几行的值：

```php
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=laravel
DB_USERNAME=root
DB_PASSWORD=
```
##### 以下是两种数据库部署的方式
1. 在项目根目录下创建chengji.sql文件
2. 使用mysql数据库的导入功能

```sh
MariaDB [laravel]> source D:\laravel5\learnlaravel5\chengji.sql
Query OK, 0 rows affected (0.29 sec)

Query OK, 0 rows affected (0.20 sec)

Query OK, 0 rows affected (0.26 sec)

MariaDB [laravel]> show tables;
+-------------------+
| Tables_in_laravel |
+-------------------+
| articles          |
| cla               |
| migrations        |
| sco               |
| stu               |
| users             |
+-------------------+
6 rows in set (0.00 sec)
```

3.也可以使用框架使用php语言，描述数据库后遭，并且用命令行一次性部署所有数据库。而且实际上，也必须用方法去部署，因为在使用php数据库操作的时候，增删改查的时候，会用到model。不妨利用model来生成数据库。下面就介绍如何用model来生成数据,下面在cmd中创建model。


```sh
D:\laravel5\learnlaravel5>php artisan make:model Stu
Model created successfully.

D:\laravel5\learnlaravel5>php artisan make:model Cla
Model created successfully.

D:\laravel5\learnlaravel5>php artisan make:model Sco
Model created successfully.
```
有了model，需要生成数据库表才行，所以先生成model的Migration和Seeder，

```sh
D:\laravel5\learnlaravel5>php artisan make:migration create_stu_table
Created Migration: 2017_06_23_103610_create_stu_table

D:\laravel5\learnlaravel5>php artisan make:migration create_cla_table
Created Migration: 2017_06_23_103647_create_cla_table

D:\laravel5\learnlaravel5>php artisan make:migration create_sco_table
Created Migration: 2017_06_23_103711_create_sco_table
```
如此，以上创建了model对应的migrations，修改他们的up函数。
- stu的up函数

```php
 public function up()
    {
        //
        Schema::create('stus', function(Blueprint $table)
        {
            $table->string('sno');
            $table->string('sname');
            $table->string('ssex');
            $table->string('sage');
            $table->string('major');
            $table->string('depart');
        });
    }
```

- cla的up函数

```php
public function up()
    {
        //
        Schema::create('clas', function(Blueprint $table)
        {
            $table->string('cno');
            $table->string('cname');
            $table->string('teano');
            $table->string('credit');
        });
    }
```

- sco的up函数

```php
public function up()
    {
        //
        Schema::create('scos', function(Blueprint $table)
        {
            $table->string('sno');
            $table->string('cno');
            $table->string('cdegree');
            $table->string('cname');
        });
    }
```
然后在cmd中输入

```sh
php artisan migrate
```
migrate成功：

```sh
Migrating: 2017_06_23_103610_create_stu_table
Migrated:  2017_06_23_103610_create_stu_table
Migrating: 2017_06_23_103647_create_cla_table
Migrated:  2017_06_23_103647_create_cla_table
Migrating: 2017_06_23_103711_create_sco_table
Migrated:  2017_06_23_103711_create_sco_table
```
数据库创建完成

```sh
MariaDB [laravel]> show tables;
+-------------------+
| Tables_in_laravel |
+-------------------+
| articles          |
| clas              |
| migrations        |
| scos              |
| stus              |
| users             |
+-------------------+
6 rows in set (0.00 sec)

MariaDB [laravel]> show columns from clas;
+--------+--------------+------+-----+---------+-------+
| Field  | Type         | Null | Key | Default | Extra |
+--------+--------------+------+-----+---------+-------+
| cno    | varchar(255) | NO   |     | NULL    |       |
| cname  | varchar(255) | NO   |     | NULL    |       |
| teano  | varchar(255) | NO   |     | NULL    |       |
| credit | varchar(255) | NO   |     | NULL    |       |
+--------+--------------+------+-----+---------+-------+
4 rows in set (0.02 sec)
```
不过我们发现问题，数据的type不怎么合适，另外没有设置主键内容，所以我们重更新migration中的up函数内容。经过不断的实现和学习，终于实现了主键的定义，外键的定义，以及将学号等定义成无符号数的方法，以及限制了字符的长度，有效节省了数据库资源。以下展示修改好的代码

```php
public function up()
    {
        //创建学生表
        Schema::create('stus', function(Blueprint $table)
        {
            $table->integer('sno')->unsigned();//学生学号
            $table->string('sname',10);//学生姓名
            $table->string('ssex',2)->default('男');//学生性别
            $table->string('sage',2);//学生年龄
            $table->string('major',10);//学生专业
            $table->string('depart',10);//所在系
            $table->primary('sno');//给学号加入主键
        });
    }
```

```php
public function up()
    {
        //创建课程表
        Schema::create('clas', function(Blueprint $table)
        {
            $table->integer('cno')->unsigned();//课程号
            $table->string('cname',10);//课程名
            $table->integer('teano')->unsigned();//教师号
            $table->string('credit',4);//该门课的学分
            $table->primary(['cno','cname']);//添加复合主键
        });
    }
```

```php
public function up()
    {
        //学生成绩查询
        Schema::create('scos', function(Blueprint $table)
        {
            $table->integer('sno')->unsigned();//学号
            $table->integer('cno')->unsigned();//课程号
            $table->integer('cdegree')->unsigned();//学生这门课的成绩
            $table->string('cname',10);//课程名
            $table->primary(['sno','cno']);
            $table->foreign('sno')->references('sno')->on('stus');
            $table->foreign('cno')->references('cno')->on('clas');
        });
    }
```
此时，我们的Model部分正式告捷，接下来做VIEW的部分







